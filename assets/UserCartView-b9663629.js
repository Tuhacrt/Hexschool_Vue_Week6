import{j as T,f as $,r as h,o as r,c,a as e,F as S,k as U,l as v,g as u,b as i,w as q,m as b,p as F,d as B,h as V,v as x,y as f}from"./index-a56c1b4c.js";const M={class:"container"},N={class:"mt-4"},A={class:"table align-middle"},L=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價")])],-1),O=["onClick","disabled"],R={key:1},H={key:0,class:"text-success"},P={class:"input-group input-group-sm"},j={class:"input-group mb-3"},D=["onUpdate:modelValue","onChange","disabled"],z={class:"input-group-text",id:"basic-addon2"},K={class:"text-end"},W={key:0,class:"text-success"},X={key:1},G={key:0},J=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),Q={class:"text-end text-success"},Y={key:1},Z=e("td",{colspan:"3",class:"text-end"},"總計",-1),ee={class:"text-end"},te={class:"my-5 row justify-content-center"},se={class:"mb-3"},ae=e("label",{for:"email",class:"form-label"},"Email",-1),oe={class:"mb-3"},le=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),ne={class:"mb-3"},de=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),re={class:"mb-3"},ce=e("label",{for:"address",class:"form-label"},"收件人地址",-1),ie={class:"mb-3"},me=e("label",{for:"message",class:"form-label"},"留言",-1),ue=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1),ge={__name:"UserCartView",setup(_e){const{VITE_URL:_,VITE_PATH:p}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"tuhacrt",VITE_TOKEN:"loginToken",VITE_TEXT:"Environment is in production build",BASE_URL:"/Hexschool_Vue_Week6/",MODE:"production",DEV:!1,PROD:!0},t=T({loadingStatus:{loadingItem:""},cart:{},form:{user:{name:"",email:"",tel:"",address:""},message:"",reset(){this.user={name:"",email:"",tel:"",address:""},this.message=""}}}),g=async()=>{var s;const n=`${_}/api/${p}/cart`;try{const o=await b.get(n);t.cart=o.data.data}catch(o){alert((s=o.response)==null?void 0:s.data.message)}},k=async n=>{var l;const s=`${_}/api/${p}/cart/${n.id}`,o={product_id:n.id,qty:n.qty};t.loadingStatus.loadingItem=n.id;try{const m=await b.put(s,{data:o});alert(m.data.message),t.loadingStatus.loadingItem="",g()}catch(m){alert((l=m.response)==null?void 0:l.data.message)}},E=async()=>{var s;const n=`${_}/api/${p}/carts`;try{const o=await b.delete(n);alert(o.data.message),g()}catch(o){alert((s=o.response)==null?void 0:s.data.message)}},w=async n=>{var o;const s=`${_}/api/${p}/cart/${n}`;t.loadingStatus.loadingItem=n;try{const l=await b.delete(s);alert(l.data.message),t.loadingStatus.loadingItem="",g()}catch(l){alert((o=l.response)==null?void 0:o.data.message)}},C=async()=>{var o;const n=`${_}/api/${p}/order`,s=t.form;try{const l=await b.post(n,{data:s});alert(l.data.message),t.form.reset(),g()}catch(l){alert((o=l.response)==null?void 0:o.data.message)}};return $(()=>{g()}),(n,s)=>{var y;const o=h("font-awesome-icon"),l=h("Field"),m=h("ErrorMessage"),I=h("Form");return r(),c("div",M,[e("div",N,[e("div",{class:"text-end"},[e("button",{class:"btn btn-outline-danger",type:"button",onClick:E}," 清空購物車 ")]),e("table",A,[L,e("tbody",null,[(y=t.cart)!=null&&y.carts?(r(!0),c(S,{key:0},U(t.cart.carts,a=>(r(),c("tr",{key:a.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:d=>w(a.id),disabled:t.loadingStatus.loadingItem===a.id},[t.loadingStatus.loadingItem===a.id?(r(),F(o,{key:0,icon:"spinner",pulse:""})):(r(),c("div",R,"移除購物車"))],8,O)]),e("td",null,[B(u(a.product.title)+" ",1),a.product.price<a.product.origin_price?(r(),c("div",H," 已套用優惠券 ")):v("",!0)]),e("td",null,[e("div",P,[e("div",j,[V(e("input",{min:"1",type:"number",class:"form-control","onUpdate:modelValue":d=>a.qty=d,onChange:d=>k(a),disabled:t.loadingStatus.loadingItem===a.id},null,40,D),[[x,a.qty,void 0,{number:!0}]]),e("span",z,u(a.product.unit),1)])])]),e("td",K,[a.product.price<a.product.origin_price?(r(),c("small",W,"折扣價："+u(a.final_total),1)):(r(),c("small",X,u(a.total),1))])]))),128)):v("",!0)]),e("tfoot",null,[t.cart.final_total<t.cart.total?(r(),c("tr",G,[J,e("td",Q,u(t.cart.final_total),1)])):(r(),c("tr",Y,[Z,e("td",ee,u(t.cart.total),1)]))])])]),e("div",te,[i(I,{class:"col-md-6",onSubmit:C},{default:q(({errors:a})=>[e("div",se,[ae,i(l,{id:"email",name:"email",label:"Email",type:"email",class:f(["form-control",{"is-invalid":a.email}]),placeholder:"請輸入 Email",modelValue:t.form.user.email,"onUpdate:modelValue":s[0]||(s[0]=d=>t.form.user.email=d),rules:"required|email"},null,8,["class","modelValue"]),i(m,{name:"email",class:"invalid-feedback"})]),e("div",oe,[le,i(l,{id:"name",name:"name",label:"姓名",type:"text",class:f(["form-control",{"is-invalid":a.name}]),placeholder:"請輸入姓名",modelValue:t.form.user.name,"onUpdate:modelValue":s[1]||(s[1]=d=>t.form.user.name=d),rules:"required"},null,8,["class","modelValue"]),i(m,{name:"name",class:"invalid-feedback"})]),e("div",ne,[de,i(l,{id:"tel",name:"tel",label:"電話",type:"text",class:f(["form-control",{"is-invalid":a.tel}]),placeholder:"請輸入電話",modelValue:t.form.user.tel,"onUpdate:modelValue":s[2]||(s[2]=d=>t.form.user.tel=d),rules:"required|min:8|max:10"},null,8,["class","modelValue"]),i(m,{name:"tel",class:"invalid-feedback"})]),e("div",re,[ce,i(l,{id:"address",name:"address",label:"地址",type:"text",class:f(["form-control",{"is-invalid":a.address}]),placeholder:"請輸入地址",modelValue:t.form.user.address,"onUpdate:modelValue":s[3]||(s[3]=d=>t.form.user.address=d),rules:"required"},null,8,["class","modelValue"]),i(m,{name:"address",class:"invalid-feedback"})]),e("div",ie,[me,V(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[4]||(s[4]=d=>t.form.message=d)},null,512),[[x,t.form.message]])]),ue]),_:1})])])}}};export{ge as default};
